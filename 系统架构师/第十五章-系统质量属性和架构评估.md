## 层次架构风格

- 属于==调用/返回-层次结构==风格，以下是展开内容

### C/S架构 和 B/S架构

- 三层**C/S**架构**关键**在于==各层之间的通信效率==
- 三层**B/S**架构
  - 将客户端变为设备上的浏览器，将应用服务器变为网络上的WEB服务器，因此也称为0客户端架构
  - **优点**：不用下载客户端，在任意终端都可以访问，使用==方便==
  - **缺点**
    - 浏览器运算能力有限，==服务器压力大==
    - 浏览器的==安全性差==
    - ==查询速度==比 C/S架构 差，因为浏览器所有数据在服务器上， C/S架构 部分数据在本地（浏览器的缓存完全比不过 C/S架构）
    - 数据提交一般以页面为单位，如用户填写表单时，整个页面的数据会被打包成一个请求发送到服务器进行处理，并刷新页面，因此动态交互性不强
- **混合架构风格**
  - **内外有别**模型：企业内人员使用 C/S ，外部人员使用 B/S
  - **查改有别**模型：查询时用查询效率较高的 B/S ，修改时用修改效率较高的 C/S
  - 开发成本高，实现困难

### 富互联网应用架构 RIA

- 解决 B/S架构 问题
  - **本质**：是0客户端，如==小程序==，其实就是软件内缓存页面，避免像浏览器那样每次重新加载
  - **优点**
    - 结合了 C/S架构 反应==速度快==、==交互强==的优点
    - 与 B/S架构 ==易于传播==的特点
    - 简化并改进了 B/S架构 的交互，将数据缓存在客户端，从而达到比 HTML ==响应速度快==，不用频繁访问服务器

### MVC架构

- 分为三层

  - **模型层**（Model）
    - 作用：处理==数据==
  - **视图层**（View）
    - 作用：将==页面呈现==给用户，==接收输入数据==
  - **控制层**（Controller）
    - 作用：页面和数据之间，处理页面==逻辑==和交互

- **缺点**：模型层 可以将数据直接交给 视图层，存在风险，如用户信息没经过过滤直接展示在视图层，应该由控制层来传递两层之间的交互

  ![MVC架构.png](https://github.com/hjxool/static-resource-save/blob/main/MVC%E6%9E%B6%E6%9E%84.png?raw=true)

### MVP架构

- 将 MVC架构 中的 控制层 变成了 ==呈现层==（==Presenter==），完全==隔绝 视图层 和 模型层 之间的联系==

  ![MVP架构.png](https://github.com/hjxool/static-resource-save/blob/main/MVP%E6%9E%B6%E6%9E%84.png?raw=true)

### MVVM架构

- 类似 MVP架构 ，但是将 呈现层 换成了 ==ViewModel==层，都是为了分离 视图层 和 模型层 ，实现==双向绑定==，目前只在前端框架中使用这个理念，没有应用到前后端服务器场景中
  - 与 **MVP架构 区别**
    - **MVP**：数据绑定是手动的，Presenter需要明确地将数据传递给View层，并且View层需要手动更新UI
      - 如，React
    - **MVVM**：数据绑定是自动的，View层通过数据绑定机制直接与ViewModel的属性进行绑定，一旦ViewModel中的数据发生变化，View层会自动更新UI
      - 如，Vue
- **优点**
  - 低耦合：视图层 独立于 模型层 变化和修改，视图变化时，数据可以不变，数据变化时，视图可以不变，且ViewModel可以绑定不同视图
  - 可复用：可以把一些视图逻辑放在ViewModel中，让多个视图层复用这段视图逻辑
  - 独立开发：开发专注业务逻辑和数据开发，设计专注页面设计

## 面向服务的架构风格 SOA

- SOA 是一种==粗粒度==、==低耦合==架构，粗粒度说明它可以单独部署、运行，低耦合说明它每个构件隔离程度高
  - 服务由以下组成
    - 封装的通用方法
    - 统一的语言格式
    - 安全防护、异常处理
    - 业务逻辑层
    - 数据访问层
    - 数据管理：SQL等

- SOA 不仅是开发方法，还具有管理优势
  - 管理员可以直接管理开发人员所构建的多个服务
    - 如一个应用对应一个服务
  - 多个服务通过 ==企业服务总线（ESB）==提出服务请求
    - 即服务不能直接通信，而是通过总线进行传递，总线连接所有服务

- SOA **目标**：让服务==最大化复用==

- SOA **特征**
  - 随时可用
    - 服务请求及时响应
  - 粗粒度接口
    - 粗粒度：只专一提供一种特定业务功能
    - 细粒度：构件方法
  - 服务分级
  - 低耦合
    - 服务使用者和服务提供者分离
  - 可复用的服务及接口
  - 标准化接口
    - **WSDL**
      - 是一种**基于XML**的**语言**，用于**描述**Web**服务**及其**功能**。它定义了服务的接口、操作、消息格式以及服务的访问地址等信息
    - **SOAP**
      - 是一种基于XML的**协议**，用于在网络上**交换**结构化**信息**。它通常用于Web服务之间的**通信**
    - **XML**
      - 是一种**标记语言**，用于**描述数据**。它具有自描述性和可扩展性，广泛用于数据交换和存储
  - 支持各种消息模式
  - 精确定义的服务接口

- **基于服务的构件** 与 传统构件 的**区别**
  - 服务构件 是==粗粒度==
    - 传统构件 一般是细粒度
  - 服务构件 是**标准接口**，主要是**WSDL接口**
    - 传统构件 是具体API形式
  - 服务构件 实现与语言无关
    - 传统构件 绑定某种特定语言
  - 服务构件 可以通过构件容器提供Qos的服务
    - 传统构件 完全由程序控制
    - **构件容器**：是一个**运行环境**，它管理和支持这些服务构件，并提供一些额外的功能，比如事务管理、安全性、负载均衡等
    - **Qos**：保证服务质量而提供的一系列技术和机制
      - 如，企业网络中，QoS服务可以优先处理视频会议和VoIP电话的数据包，确保这些实时应用的质量，而将文件下载和邮件传输等非实时应用的数据包放在次要位置处理

- SOA **关键技术**

  ![SOA关键技术.png](https://github.com/hjxool/static-resource-save/blob/main/SOA%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF.png?raw=true)

  - **描述服务**：负责服务的描述，通常使用WSDL（Web服务描述语言）来描述服务的接口、方法、参数等信息
    - 就像写简历一样，把服务的功能、输入输出都详细描述清楚，方便别人调用
    - **WSDL**：==把WEB服务描述定义为一组服务访问点，用于描述服务==（考点）
      - 就像服务的**说明书**，告诉你怎么调用这个服务
  - **发现服务**：就是找到现有的服务
    - 如，需要一个支付服务，可以通过服务注册中心找到它的地址和接口
    - **UDDI**：==用于WEB服务注册统一描述、发现、集成==（考点）
      - 可以把它理解成一个**黄页**，服务提供者可以在上面注册他们的服务，服务使用者可以通过它查找需要的服务
  - **消息格式层**：服务之间传递的数据的格式。常见的格式有XML和JSON
    - 如，调用一个天气预报服务时，服务返回的数据可能是一个JSON格式的天气信息
    - **SOAP**：基于XML的协议，==用于传递信息==（考点）。定义了消息的格式和传输的规则，确保不同系统之间可以互相通信
      - 调用一个远程服务时，可能会用SOAP来传递请求和响应
  - **编码格式层**：消息在传输过程中使用的编码方式。常见的有UTF-8、ASCII等
    - **XML**：==用于数据交换==（考点）
  - **传输协议层**：服务之间通信所使用的协议。常见的有HTTP、HTTPS、SOAP等

- （考点）**SOA** 三种**实现方式**

  - **WEB Service**
    - 服务==提供者==、服务==注册==中心（中介、提供交易平台，可有可无）、服务==请求者==
  - **服务注册表**
    - 服务==注册==
      - 应用开发者（即**服务提供者**）在注册表中公布服务的功能
    - 服务==位置==
      - 帮 服务使用者（即**应用开发**者）查询注册服务，寻找合适的服务
    - 服务==绑定==
      - 应用开发人员 利用检索到的服务接口编写代码，所编写的代码将与注册的服务绑定，调用注册的服务
  - **企业服务总线ESB**
    - 就像一根管道，==连接不同协议的服务==，并对其进行==转化==、==解释==，以及==路由==，以此让==不同的服务互联互通==
    - **包括**：==客户端==（服务请求者）、==基础架构服务==（中间件）、==核心集成服务==（提供服务）
    - **特点**
      - 在 面向服务的架构 中起到==总线==的作用，将各种服务进行整合
      - ==描述==服务的==元数据==和服务==注册管理==
        - **元数据**：如“创建订单”的服务，元数据就会描述这个服务的输入参数（比如订单号、客户信息等）、输出结果（比如订单确认信息）以及调用这个服务的URL等
        - **注册管理**：就是个目录，记录了所有可用服务的详细信息
      - 在服务请求者和提供者之间==传递数据==，并对这些数据进行==转换==，支持同步、异步
      - 具有路由的功能，能匹配、选择对应的服务

## 质量属性（重点）

### 软件系统属性

- 即开发的软件系统有哪些需要关注的点，包括==功能==属性、==质量==属性
  - 软件架构 重点关注的是**质量**属性
  - 为了精确定义系统的 质量属性 ，通常采用==质量属性场景==的方式来描述
  - 进行完 **质量属性场景描述** 后，就需要对系统==架构==进行==评估==
    - 架构评估：是对架构进行分析、评估，然后得出架构是否可行
- （考点）**质量属性** 一定是系统==可测量==、==可测试==的属性。是软件系统==满足用户需求的程度==，是衡量软件系统质量的==重要指标==
  - 可测量：能够量化得到的数据
  - 可测试：能够通过用例进行测试
- （考点）基于软件系统的生命周期，将质量属性分为
  - ==开发期质量==属性
    - 从以下方面关注**开发者**
      - 易理解性：功能是否容易被理解
      - 可扩展性：开发的功能是否容易进行扩展，也叫灵活性
      - 可复用性：功能是否低耦合
      - 可测试性
      - 可维护性
      - 可移植性
  - ==运行期质量==属性（考点）
    - 从以下方面关注**用户**
      - ==性能==：如运行速度、数据吞吐率
      - ==安全==性：抵抗外部攻击的能力
      - ==可伸缩==性：随着用户数量的增加，维持高服务质量的能力
        - 如，增加服务器
      - ==互操作==性：调用外部API的难易程度
      - ==可靠==性：能否长时间运行不出问题
      - ==可用==性：出现问题后，能否快速恢复到使用状态
      - ==鲁棒==性：出现问题后，能正常运行的能力。也称为**健壮**性、**容错**性

### 评估架构的质量属性（考点）

- 考点
  - 知道每个质量属性表示的**意思**
  - 知道每个质量属性**衡量指标**
  - 每个质量属性对应的**优化方案**
- **评估**用的 质量属性 包括
  - **性能**
    - 指==系统的响应能力==
    - **衡量指标**
      - ==响应时间==：按下按钮搜索，要多久才能返回结果
      - ==吞吐量==：某段==时间内==系统能==处理的事件个数==
    - **优化方案**
      - ==优先级队列==：优先级高的放前面
      - ==增加计算资源==
      - ==减少计算开销==：关闭没必要的程序
      - ==引入并发机制==
      - ==采用资源调度==
  - **可靠性**
    - 指==一段时间内保持正常运行，不发生故障==的能力
    - **衡量指标**：计算一段时间内发生故障的概率
      - ==MTTF==：平均**无**故障时间
      - ==MTBF==：平均故障**间隔**时间
      - ==MTTR==：平均故障**修复**时间
      - **公式**：`MTBF = MTTF + MTTR`
    - **优化方案**
      - ==心跳==：设置心跳时间，一旦心跳停止说明出了问题
      - ==Ping/Echo==：就是常说的ping连接，测试网络连通性；Echo指回显
      - ==冗余==：多备一些设备，如A设备离线，立马启动B设备
      - ==选举==：同时运行多台设备，如果其中有设备挂了，就同步其他设备的数据
  - **可用性**
    - 指系统==处于可操作状态的时间比例==
    - **衡量指标**：计算一段时间内可操作的百分比
      - **公式**：`百分比 = (总时间 - 修复故障时间) / (总时间)`
    - **优化方案**：同可靠性优化方案完全一样
    - 与 可靠性 的**区别**
      - 可用性 强调从故障中恢复的能力，可以理解为灾后恢复的速度
      - 可靠性 强调多长时间没发生故障，可以理解为多长时间没发生灾难
  - **安全性**
    - 指==阻止非授权用户==的能力
    - **衡量指标**
      - ==保密==性：只有开放权限的用户能够访问
      - ==完整==性：发送的信息不会被**未经授权**的修改或破坏
      - ==不可抵赖==性：如数字签名
      - ==可控==性：系统运行过程能被有效监控和管理
    - **优化方案**
      - ==入侵检测==
      - ==用户认证==
      - ==授权管理==
      - ==追踪审计==
  - **可修改性**
    - 指==更新系统的性价比==
    - **优化方案**：按照==面向对象设计原则==即可保证可修改性
      - ==接口-实现分离==
      - ==抽象==
      - ==信息隐藏==
  - 功能性
    - 指==满足用户需求==和实现预期功能方面的能力
  - 可扩展性
    - 指架构能==扩充为新的架构==的能力
  - 互操作性
    - 指**不同系统**或组件之间==调用彼此接口==的能力
  - 易用性
    - 指用户界面和==用户体验==

### 质量属性场景描述

- 通过具体的场景描述质量属性。质量属性场景 描述==系统如何满足**特定**质量属性**需求**的场景==
- 由以下部分**组成**
  - 刺激源：==谁==。如用户
  - 刺激：==做什么==。如用户请求登录
  - 环境：==在什么样的环境下运行==。如高负载时
  - 制品：==对环境中的那个功能进行刺激==。如用户信息管理模块
  - 响应：==系统采取什么样的措施==。如切换备用服务器
  - 响应度量：==衡量系统采取的措施==。如故障恢复时间
- 例：电子商务网站，其中一个关键质量属性是性能，希望确保网站在高负载时仍能快速响应
  - 场景：高负载购物日
  - **描述**：每年假期购物季节，我们预期会有大量用户访问网站，进行在线购物，在高负载购物日，预计用户流量将增加至平时的10倍
    - 刺激源：网站用户
    - 刺激：访问购物网站、浏览商品、结算
    - 环境：12月24至12月25日
    - 制品：整个系统，尤其是用户交互部分
    - 响应：使用负载均衡、缓存静态内容
    - 响应度量：网站加载时间、服务器资源利用率

## 系统架构评估

### 相关概念

- ==敏感点==
  - **定义**（考点）：指为实现**特定**的**质量属性**，一个或多个构件所具有的特征
  - 注：不论是提高或是降低质量属性，都属于敏感点
  - 如描述“XX操作，影响到了性能”，这个描述就属于 敏感点 ，因为只影响到了性能
- ==权衡点==
  - **定义**：指影响**多个**质量属性的特征，是**多个**质量属性的**敏感点**
  - 注：权衡点 包含 敏感点 ，而 敏感点 只拥有一种质量属性
  - 如描述“XX操作，影响到了性能和安全性”，这个描述就属于 权衡点
- ==架构风险==
  - **定义**：架构设计中潜在的，存在问题的架构==决策所带来的隐患==

- ==风险点==
  - 可能对项目==造成负面影响==的因素
  - **关键字**：==影响==
  - 如描述，“对交易请求处理时间的要求将**影响**系统数据传输协议和交易处理过程的设计”

- ==非风险点==
  - 对项目没有明显负面影响的因素
  - 如描述，“项目中使用的某个工具的版本进行了更新”

- ==风险承担者==（或==利益相关人==）
  - 指跟架构开发相关的人员
  - 如架构师、开发人员、测试人员、专家
- 架构评估 处于==架构设计之后==，==系统设计之前==
  - 目的：评估所采用的架构能否**解决**软件系统需求（功能需求 和 质量需求）

### 评估 方式

- 基于==调查问卷==的方式
  - **特点**：获取==主观==反馈和意见、评估人员要有架构方面的了解
- 基于==度量==的方式
  - **特点**：非常==客观==，如代码行数、响应时间、内存使用率等
- （考点）基于==场景==的方式
  - **特点**：从==风险承担者==的角度与系统**交互**的描述
  - **实施过程**
    1. 确定功能和构件之间的关系
       - 如做一个用户登录**功能**，需要==关联==到哪些==构件==
    2. 针对该功能相关的质量属性，写一个==质量属性场景描述==
       - 如用户登录功能，相关的质量属性有安全性、性能，写一段与安全性和性能有关的场景描述
    3. 然后根据 质量属性场景描述 分析，当前==架构对场景的支持度==
    4. 得出评估结果
  - 对三个场景进行设计：==刺激==、==环境==、==响应==
    - 如网络视频流媒体服务的架构评估，质量属性场景描述 为“同时1000名用户观看高清视频”或“网络阻塞时仍能提供无缝视频流“，然后模拟这些场景，测试系统性能、可用性、容错性

### 评估 方法

- （了解）基于==场景==的架构分析方法SAAM

  - **特点**：分析==可修改性==的架构分析方法
  - 架构描述**关键字**：==功能==、==结构==、==分配==
  - 方法**活动**：问题描述、需求声明、架构描述
  - 评估**步骤**：场景开发、架构描述、单个场景评估、场景交互、总体评估

- （考点）==架构权衡分析法ATAM==

  - **特点**：分析==性能==、==可用性==、==安全性==、==可修改性==的方法

  - **活动**：整个过程强调以==质量属性==为核心

    - ==场景和需求收集==
      - 即收集需求和确定场景
    - ==架构视图和场景实现==
      - 设计架构视图和场景
    - ==属性模型构造和分析==
    - ==架构评估和折中==

  - **产出**：==效用树==

    - **结构**：`树根 -> 质量属性 -> 属性分类 -> 质量属性场景(叶子节点)`
    - (重要度，难易度)：都是H级别最高，下来是M，在下来是L
      - 重要度：场景的重要程度。放在括号第一个
      - 难易度：场景实现的难易度。放在括号第二个

  - **写论文**：按以下阶段，分段描述是如何评估架构

    1. **描述和介绍阶段**
       - **目标**：介绍评估的项目是什么，评估哪几点质量属性，评估的方法是什么，采用的什么架构
       - 例：电子商务网站的架构评估，评估团队会与项目干系人合作，确定评估的目标是提高性能和安全性，他们收集有关架构的文档，如架构图和设计文档
    2. **调查与分析阶段**
       - **目标**：根据上一阶段获得的架构材料、构件、质量属性，分析架构所使用的架构方法，评估这些架构方法对质量属性的影响（**产出**质量效应树），识别潜在的问题并决策
         - 架构方法：即 架构决策，指具体实现的功能和引入的构件
       - 例：评估团队定义不同的 架构决策 ，如引入缓存和增加服务器资源，生成质量效应树，以分析这些决策对性能和安全性的影响
    3. **测试阶段**
       - **目的**：验证架构能否满足质量属性需求
       - 例：评估团队会讨论电子商务网站的性能、可伸缩性、安全性场景，对它们的重要性进行分级，并分析引入缓存和增加服务器资源等不同架构方法的影响。项目相关人员进行投票，选择合适的架构方法
    4. **报告阶段**
       - **目的**：报告总体评估的结果，提供改进建议，为决策者提供决策依据
       - 例：电子商务网站的评估报告可能包括性能测试结果、安全性评估、改进建议、以及质量属性的相关权衡，报告提供给项目管理团队，以指导后续决策和改进

    ![架构权衡分析法ATAM.png](https://github.com/hjxool/static-resource-save/blob/main/%E6%9E%B6%E6%9E%84%E6%9D%83%E8%A1%A1%E5%88%86%E6%9E%90%E6%B3%95ATAM.png?raw=true)

- （论文水字数）==成本效益分析法CBAM==

  - **特点**：如果ATAM超预算了，可以用该方法，从成本的角度对 ATAM 进行补充

## 中间件

- 在**分布式系统**环境中，处于操作系统和应用程序之间的软件
- **作用**：帮助不同的应用程序进行==通信==和==数据交换==
- **特点**
  - 位于==操作系统==之上，管理计算资源和==网络通信==
  - 不是一种软件，而是一类软件
  - 中间件不只实现互联，还要实现应用间互操作
  - 中间件 是基于 **分布式** 处理的软件，最突出的特点是网络通信
    - 考到中间件一般就是考==分布式==、==网络通信==这两个词汇
- 中间件的**任务**：提统一的程序抽象，隐藏异构系统和分布式系统下低级别编程的复杂程度
- **分类**
  - ==数据库访问中间件==
    - 通过==抽象层==访问==数据库==，从而允许相同代码访问不同数据库资源
    - 如，window平台的ODBC、Java平台的JDBC
  - ==远程过程调用（RPC）==
    - 就是让你在一台机器上调用另一台机器上的==函数==或方法，就像调用本地函数一样方便
  - ==面向消息中间件（MOM）==
    - 通过消息传递来实现==分布式系统中各个组件之间通信==的技术。它的核心思想是==解耦==生产者和消费者，让它们通过消息队列进行异步通信
    - 如==RabbitMQ==
  - ==分布式对象中间件==
    - 用于在==分布式系统==中实现==对象之间==通信和协作的技术。它的核心思想是将分布在不同物理节点上的对象通过中间件进行连接，使得它们能够像在同一个内存空间中一样进行交互
    - 如第十四章，构件分类中的EJB、DCOM等
  - ==事务中间件 / 事务处理监控器（TPM）==
    - 用于管理和协调==分布式事务==处理的中间件。它的主要作用是确保在分布式系统中，多个参与者的操作要么全部成功，要么全部失败，从而保证数据的一致性和完整性