## 网络互联模型及协议

### 网络功能和分类

- 计算机网络功能
  - 数据==通信==
  - 资源==共享==
  - 管理==集中==化
  - 实现==分布式==处理
  - ==负载均衡==
- 性能指标
  - 速率（每秒多少兆）
  - 带宽（每秒最大==上限==）
  - 吞吐量（每秒==成功传输==数据量）
  - 时延（传输数据的延迟）
  - 利用率（真实传输速率 / 带宽 的百分比）
- 非 性能指标
  - 费用（办网费用）
  - 质量（能否穿墙）
  - 标准化
  - 可靠性
  - 可拓展性
  - 可升级性
  - 易管理性
  - 可维护性
- 按 ==分布范围== 分类
  - ※局域网（LAN）
    - 分布距离 ==1km== 以内
    - 使用场景
      - 房间、楼栋、校园
    - 速率
      - 4**M**bps ~ 1**G**bps
  - 城域网（MAN）
    - 分布距离 ==10km==
    - 使用场景
      - 城市
    - 速率
      - 50**K**bps ~ 100**M**bps
  - ※广域网（WAN）
    - 分布距离 ==100km== 以上
    - 使用场景
      - 国家、全球
    - 速率
      - 9.6**K**bps ~ 45**M**bps
- 按 ==拓扑结构== 分类
  - 总线型
    - 计算机节点都连到一根总线上
    - 利用率低、干扰大、价格低
      - 干扰大：一台机器出问题会影响总线上其他机器
  - 星型
    - 常见于家庭路由器
    - 交换机形成的局域网、中央单元负荷大
  - 环型
    - 闭环
    - 流动方向固定、效率低、扩充难
      - 效率低：每台机器的瓶颈都成为了整个网络的瓶颈
      - 扩充难：一旦加入新机器，就得重新搭建
  - 树型
    - ==总线型==的扩充、分级结构
      - 总线型的扩充：比 总线型 多了==分级结构==
  - 分布型
    - 任意节点连接、管理难、成本高
      - 任意节点连接：每台机器都要知道其他机器的地址以及==映射关系==
      - 管理难：一旦有机器出了问题，要对其他节点的机器更新信息

### 网络互联模型

- 概念

  - 即网络上能找到的机器两两间如何连接

  - 如果是本地的、机器少，直接找根 **网线** 就能连接
  - 如果有多台，就找个 **交换机** ，交换机通过机器的MAC地址互相连接
    - MAC地址：每台网络设备都有自己**唯一**的MAC地址
  - 再远一点，如果有多个网段，但是同属一个==局域网==，加配 **路由器** ，路由器之间通过 ==IP== 连接
    - IP地址：也是唯一的，但分 广域 和 局域网 内的IP地址
  - 更远一些，如果 局域网 之间要连接，就需要使用**国际标准**组织制定的标准，即 ==OSI体系标准==

- OSI体系结构

  - 考点：每层相关 协议、作用
  - 分7层
    - 建立==连接==依靠 物理层、数据链路层、网络层
    - ==传输==数据依靠 传输层
      - 传输层：决定传输方式，如快递选中通还是德邦
    - ==数据==形式依靠 会话层、表示层、应用层
      - 简单记，决定数据是画出来，是用英文还是中文等等

- TCP/IP 体系结构

  - 是对 OSI体系结构 的简化
  - 如OSI的会话层、表示层、应用层合并为 ==应用层==
    - 物理层、数据链路层合并为 ==网络接口层==
    - 传输层、网络层 原样保留

#### OSI体系结构

1. 物理层

   - 简单理解，就是==物理层面==连根网线将开放系统连接
   - 协议：RS232、V.35、RJ-45、FDDI等
   - 都是用 ==二进制==传输，形式就是电信号、光信号等
   - 主要设备
     - 中继器
     - 集线器

2. 数据链路层

   - 因为二进制传输不安全，缺乏加密，所以有数据链路层，将二进制封装为以 ==帧== 为单位的信息
     - 帧：就像快递包裹，包裹里是二进制数据，包裹外有标签(控制信息)，从而保证传输过程不会损坏和丢失。通常包括帧头、数据部分、帧尾
       - 帧头：包裹标签，告诉网络这个数据包从哪儿来，要到哪儿去
       - 帧尾：包裹的封条，即校验信息，检查数据在传输过程中有没有出错

   - 是针对 ==MAC地址== 建立的链路
   - 协议：IEEE802.3/.2、HDLC、PPP、ATM等
   - 主要设备
     - ==交换机==
     - 网桥

3. 网络层

   - 在传输单位上做的升级，将==数据分组==用于传输
     - 类似大件行李通过拆分运送，将一块数据==分段==传输
   - 解决==路由选择==、==网络拥塞==、==异构网络互联==的问题
     - 网络层好比一个国际快递公司，从一个国家送到另一个国家，即使两个国家的邮政系统完全不同，国际快递公司使用统一的标准和流程，确保包裹能够顺利送达
   - 协议：IP、IPX等
   - 主要设备
     - ==路由器==

- 通过上面三层，机器在网络中就能==定位==到了，机器间==连接方式==也确定了

4. 传输层
   - ==端口到端口==连接，传输报文
     - 端：比如电脑上多个端口
       - 与数据链路层连接方式的区别
         - ==数据链路层==是 MAC 到 MAC
         - ==传输层==是 端口 到 端口
     - 报文：传输层会把数据分成一个个小块，每个小块就叫做“报文”
       - 与网络层数据分组的区别
         - 网络层分的更细！好比寄一套书给朋友，网络层是将每本书装进不同的包裹，并写上寄件人和收件人的地址
         - 而传输层相当于把装着一个个包裹再分组，并标注上序号
       - 注意！UDP不会拆分报文，这里主要描述的是TCP协议下的情况
   - 协议：TCP、UDP等
   - 主要设备
     - ==网关==
5. 会话层
   - 主要是确认==通信的权限==。服务包括通信控制、检查点设置、中断重连、安全验证
   - 协议：==SSL==、SQL、RPC等
   - 主要设备
     - 网关
6. 表示层
   - 将原始数据转换成应用层指定的形式，具备转换数据的能力
     - 如页面上的图片，其实在后台是原始数据，而表示层就是将原始数据处理成能直观看到的
   - 协议：JPEG、ASCII、GIF等
   - 主要设备
     - 网关
7. 应用层
   - 直接和用户交互的那一层，主要作用就是提供==网络服务==
     - 如：WEB页面就是应用层
   - 协议：HTTP、FTP、Tenlent等
   - 主要设备
     - 网关

#### 网络常用设备

- 中继器
  - 用于：==物理层==
  - 作用：对接收信号的再生和发送，==只起到扩展**传输距离**的作用==，对高层协议透明，但使用个数有限(如在以太网中只能使用4个)
    - 如马拉松中途会有补给站，喝口水补充体力才能继续跑
- 网桥
  - 用于：==数据链路层==
  - 作用：根据==帧物理地址==进行网络之间的==信息转发==，可缓解网络通信繁忙，提高效率。==只能连接在**相同**数据链路层**协议**下的网络==
    - 帧物理地址：即==MAC地址==
    - 如：家里有一个客厅的网络，和书房的网络，网桥会读取数据 帧 中的源MAC地址和目的MAC地址，然后根据这些地址来决定是否转发数据帧到另一个网络段
- 路由器
  - 用于：==网络层==
  - 作用：通过==IP地址==进行网络间信息转发，可完成 异构网络 间的互联互通。==只能连接**相同**网络层**协议**的**子网**==
- 网关
  - 用于：4~7层，即传输层到应用层
  - 作用：最复杂 的网络互联设备，可以连接==不同协议的子网==
- 集线器
  - 用于：物理层
  - 作用：多端口==中继器==
- 二层==交换机==
  - 用于：数据链路层
  - 作用：传统意义上的交换机，多端口==网桥==
    - 注意：因为本质是网桥，所以通过MAC地址识别转发，而==路由器==则是通过==IP地址==

#### 数据是如何互相传输的？

- 其实就是层层打包，另一方在逐层拆包
- 如 A主机 的 应用层 将传输数据(如data里面的字段)打包，给到 表示层 明确是JPG还是DES加密，再到 会话层 进行SSL加密，再到 传输层 进行TCP加密，再到 网络层 将目标I，源P地址包进来，再到 数据链路层 将收件人发件人的MAC地址包进来，再到 物理层 将数据转换成 电信号 ，通过 ==通信介质== 即网线、光纤等，连接到 B主机 ，B主机 通过 物理层 将电信号还原回二进制数据，再通过 数据链路层 找MAC地址，再到 网络层 找IP地址，再到 传输层 知晓是TCP协议，再到 会话层 知道是SSL，再到 表示层 进行解密，再到 应用层 将数据展示

### 常见网络协议

#### 网络层协议

- ※==IP==
  - 网络层 **最重要** 的核心协议，在 源地址 和 目的地址 之间传输数据，无连接、不可靠。它将 差错检测 和 流量控制 等服务授权给其他各层协议，这正是TCP/IP能够高效工作的保证。网络层 功能主要由 IP 来提供，除了 端到端 分组分发功能，还有其他扩充功能。如数据分块和重组功能用于突破 数据链路层 对帧大小的限制，使得很大的 IP 数据包可以以较小的分组在网络传输
    - 无连接：如给朋友寄快递，包裹上写了寄件人和收件人的地址，快递公司不需要提前通知对方“我要寄包裹了”，直接发就行
    - 不可靠：如寄快递，快递公司不保证每个包裹都一定能送到，有可能会丢件、延误或者顺序错乱
- ICMP（网际控制报文协议）
  - 用于在 IP主机、路由器 之间传递==控制消息==
    - 控制消息：网络通不通，路由是否可达等网络本身的消息。如访问网站，电脑回发送请求到网站服务器，服务器收到会恢复一个应答消息，吐过能收到应答，说明网络连接正常，没收到则说明网络有问题
- ARP（地址解析协议）和 RARP（反向地址解析协议）
  - ARP：将 IP地址 转换为 MAC地址
  - RARP：将 MAC地址 转换为 IP地址
- IGMP（网际组管理协议）
  - 网络 ==组== 管理协议，允许网络上的计算机参加==多播==，是计算机向 相邻 组播路由器报告自己成员的协议，支持组播
    - 组播(多播)：一种网络通信方式，由一个发送者把数据发送给多个接收者，但不是发给所有人，而是发给一个特定的组。如微信群发消息，这个消息只有群里的成员能看到，而不是你所有的微信好友
    - 何为管理协议：在一个小区里，每个住户（主机）都可以选择加入某个兴趣小组（多播组），而小区的物业管理（路由器）需要知道哪些住户加入了哪些小组，以便在有活动（数据包）时通知相关的住户。IGMP协议就像是物业管理用来收集和更新这些信息的工具

#### 传输层协议

- ※TCP（传输控制协议）
  - 在IP协议提供的不可靠数据服务的基础上，采用了==重发技术==，为应用程序提供了一个==可靠的、面向连接的、全双工==的数据传输服务
    - 重发技术
      - 超时重传：如发了一条微信消息，如果对方一直没回，会再发一次确认对方是否收到
      - 快速重传：接收方收到一个失序的数据包时，会发送重复的ACK给发送方，告诉它==上一个正确==接收到的数据包序号。发送方如果==连续==收到==三个相同==的ACK，就会立即重传下一个数据包，而不必等待超时。如发了一连串的快递包裹，结果中间一个丢了，收件人会连续告诉你“我只收到第5个包裹”，你就知道第6个包裹丢了，并立即重发
      - 选择性确认：这个机制允许接收方告诉发送方具体哪些数据包已经收到，哪些还没有收到。这样发送方只需要重传那些丢失的数据包，而不是重传整个窗口的数据。如发了一套书给朋友，他告诉你“第1、2、4、5本收到了，第3本没收到”，你就只需要重发第3本书
    - 面向连接的：双方必须建立连接。TCP使用3种机制实现面向连接
      1. 使用==序号==对数据报进行==标记==。使得 传输层 在向 会话层 及以上层传递数据之前==调整失序==的数据包
         - 数据报：网络通信中的一个基本单位。数据报头部包含源地址、目标地址、数据长度、校验和等。
      2. TCP使用确认、校验、定时器提供可靠性。当接收者识别到数据错误，会通知发送者，或者 当接收者一段时间没有回复确认消息，发送者会认为数据包没有到达，这两种情况发送者都会重传数据
         - 就是TCP最经典的 三次握手，四次挥手 建立连接方式
      3. TCP使用窗口机制调整数据流量。并且窗口大小随网络情况调整
         - 窗口机制：即数据==分组==的==大小==
  - 一般用于数据量较少，对可靠性要求高的场合
- UDP（用户数据报协议）
  - ==不可靠、无连接==协议，能保证通信，与TCP相比错误检测功能弱的多，但不是没有
    - UDP的错误检测方式：校验和
      - UDP在发送数据时，会计算总和，然后将总和值填入UDP头部的对应字段。接收方在收到数据后，会重新计算数据总和，并与头部中的总和值进行比较。一致，说明数据报在传输过程中没有发生错误，不一致，则说明数据报可能在传输过程中出现了错误
      - 这种校验方式只能直到数据传输是否出错，无法校正，且==发送方可以不计算 校验和==，这样接收方就无法进行校验
  - 一般用于数据量大，对可靠性要求不高，但要求速度快的场合
  - 特性
    - ==无连接==：发送数据前不需要建立连接，减少了开销和发送数据前的延迟
    - 尽最大努力交付：不保证可靠，因此主机不需要维持复杂的连接状态表
    - UDP是==面向报文的==：==UDP==对于应用层传下来的数据，不会进行拆分或合并，而是==一次性交付完整数据==
      - 注：==TCP==会将应用层传下来的数据==进行分组==
    - ==没有 拥塞控制==：因此网络拥塞不会使主机发送速率降低。这对实时应用很重要
    - UDP支持一对一、一对多、多对一、多对多的==交互通信==
    - UDP的==首部==开销小：只有8字节，比TCP的20字节短
- 总结
  - TCP提供可靠性，UDP提供高传输速率

#### 应用层协议

- 基于 **TCP** 的是==可靠传输==，基于 **UDP** 的是==不可靠传输==
- FTP
  - 基于 TCP
  - ==文件传输==协议。控制文件的双向传输
- HTTP
  - 基于 TCP
  - ==超文本==传输协议。用于从WWW服务器==传输**页面文件**到本地浏览器==的传输协议，使用==SSL加密后==的协议为==HTTPS==
    - 超文本：即嵌入的链接，也叫超链接。使用户可以在不同内容之间跳转
- SMTP 和 POP3
  - 基于 TCP
  - 简单邮件传输协议。用于从 源地址 到 目标地址 传送邮件的规则。SMTP 用于发送，POP3 用于接收
- Telnet
  - 基于 TCP
  - 远程连接协议。用于==远程访问==其他计算机
- TFTP
  - 基于 UDP
  - ==小文件==传输协议。使用==**超时重传**方式保证数据送达==
- SNMP
  - 基于 UDP
  - 简单 网络管理协议。就像是网络管理员的助手，帮助他们==远程查看==和控制网络设备的状态
- DHCP
  - 基于 UDP
  - 动态主机配置协议。基于C/S模型，为主机分配IP地址，有三种方式：固定分配、动态分配、自动分配
    - C/S模型：即客户机/服务器模型，是一种网络架构。如在线游戏，任务被分成两个部分，客户端和服务器端，客户端发送请求和渲染，服务器处理玩家数据和游戏逻辑，并返回给客户端
- DNS
  - 基于 UDP
  - 域名解析协议。通过 ==域名== 解析出 ==IP地址==
    - 域名：互联网的“地址簿"，如`www.example.com`
    - IP地址：服务器的门牌号，服务器的唯一标识。如`192.168.1.1`
      - 注：服务器下可以有多个设备，每个设备也有自己的IP地址，这个叫 ==内网IP==，而服务器的IP是 ==公网IP==

## ※ IP地址 及 子网

### ※ IPV4

- IPV4地址是一个==**32**位的**二进制**逻辑地址==，为表示方便，一般用==点分十进制==方式表示
  - 点分十进制：将32个0、1每==8位==转化成==十进制==，变成==4个十进制==，再将这4个十进制用`.`间隔，如`128.11.3.31`
  - 因为是==8位==二进制转换，所以==0~255==范围由此得来
  - 注：二进制以==8位==为一个==字节(1byte)==，`1byte == 8bits`
- IP地址分由 ==网络号== 和 ==主机号== 两部分组成，如`192.168.1.10`，它的==网络号==是`192.168.1.1`，表示设备属于`192.168.1.1`这个网络，==主机号==是`10`，表示这个网络中的第10号设备
  - 与 公网IP 和 内网IP 的区别
    - **公网IP和内网IP**：区分设备是在**局域网**还是**互联网**中
      - 公网IP：是分配给设备的**全球唯一**的IP地址
      - 内网IP：是分配给**局域网内**部设备的IP地址
    - **网络号和主机号**：==划分==和==标识==**同一网络环境**中的设备

#### 有分类表示方式

- ※ IP地址根据 ==网络号 位数==的不同，划分为以下几类
  - ※ A类
    - 范围从`0.0.0.0`到`127.255.255.255`，网络号只占一位，即只占`127`这一位，后面三位`255.255.255`是可自由分配的==主机号==
      - 范围：指 网络号 的范围，只能从`0~127`，为什么是`127`？因为 A类 特点，32位二进制中，**第一位**必须是 **0**，如最大`01111111 11111111 11111111 11111111`
    - 特点
      - 二进制==首位==必须是==0==
      - ==网络号只占一位==
  - ※ B类
    - 范围从`128.0.0.0`到`191.255.255.255`，网络号占两位，即占`191`、`255`这两位，后面两位`255.255`是可自由分配的==主机号==
    - 特点
      - 二进制==头两位==必须是==10==
        - 如`10111111 11111111 11111111 11111111`
      - ==网络号占两位==
  - ※ C类
    - 范围从`192.0.0.0`到`223.255.255.255`，网络号占三位，即占`223`、`255`、`255`这三位，后面一位`255`是可自由分配的==主机号==
    - 特点
      - 二进制==开头三位==必须是==110==
        - 如`11011111 11111111 11111111 11111111`
      - ==网络号占三位==
  - D类 ==组播==
    - 范围从`224.0.0.0`到`239.255.255.255`，网络号占三位，，即占`239`、`255`、`255`这三位，后面一位`255`是可自由分配的==主机号==
    - 特点
      - 二进制==开头四位==必须是==1110==
        - 如`11101111 11111111 11111111 11111111`
      - ==网络号占三位==
  - 总结
    - 总之就是==二进制头部==和==占据网络号==位数两方面特点，其次就是注意==首位区间==
    - 其实各类地址的==网络号范围==从==二进制的头部规则==就能得出

#### 无分类表示方式