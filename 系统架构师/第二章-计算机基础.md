## Cache的地址映像方法

- `Cache`是为了解决==内存和CPU之间==速度容量不匹配的问题(==运算==速度越来越==快==，而==写入==速度==跟不上==)，在这个过程中会将==主存内容**复制**到cache中==，方便CPU==就近访问==
- 计算机一般按照==页==或==块==的方式调用，毕竟按`1bit`之类的调用太过细致
  - 何为页/块，即将主存分为==大小相同==的区域
    - ==页面、块、缓存块==是一个东西
    - 这里的大小相同，**不是**指等比划分，而是真的大小一致，如主存划出`3KB`大小的块，`Cache`也要划出`3KB`大小的块
  - 按页/块调用的过程中，会形成地址映射关系
    - 注意！主存和`Cache`之间的映射由**硬件**来完成

- 映射规律：分为**直接**相联映像、**全**相联映像、**组**相联映像
  - 直接：主存和**块**与`Cache`**块**的对应关系是**固定的**
    - 即将主存划分成和`Cache`大小一致的区域，如0号区，1号区，2号区，`Cache`也同样，主存的0号区只能放在`Cache`的0号区
    - 缺点：易**冲突**，如果这个位置已经被占用了，新数据会替换掉原来的数据
    - 优点：**硬件**电路设计简单，复杂度低
  - 全：依旧划分成大小相同的块，但是==任意主存地址都可以存放在Cache的任何位置==，需要一个**查找表**来管理所有的**映射关系**
    - 缺点：电路设计复杂，只适用==小容量==的`Cache`，==无法从主存块中直接获取Cache块==，因此速度慢
    - 优点：冲突率低，灵活
  - 组：直接和全相联的**折中**形式，将`Cache`中的==块分成组==，组内采用全相联方式
    - 如：主存任何区的0组只能存到`Cache`的0组，1组只能存到`Cache`的1组中，而组内，主存1组的任意块可以存入`Cache`1组的任意块
    - 先分区，再分组

## Cache替换算法

- 又名，页面==置换==算法，或页面==淘汰==算法

-  常见替换算法
  - 随机替换算法(==RAND==)：使用**随机数**作为==被替换块号==，将该块号替换出去
  - 先进先出算法(==FIFO==)：替换==最早==进入缓存的块
  - 近期最少使用算法(==LRU==)：替换近期最少==使用==的块。根据`Cache`中块的==使用==时间
  - 最不频繁使用使用算法(==LFU==)：替换==访问次数==最少的块。用一个==计数器==记录==访问==块的==次数==
    - 注：==LFU使用计数器==，这是曾经的考点
  - 优化替换算法：==先执行一次==程序，==统计开始时的替换情况==，在后续执行中==选择合适的缓存块==进行替换
- `Cache`的读写过程
  - `Cache`的内容是==从主存**直接**复制==，在CPU的调度下使用
  - CPU在使用过程中有==可能会修改块的内容==，因此会造成`Cache`和内存中不一致的情况，因此有3种**读写算法**：
    - **写直达**：同时写入`Cache`和内存
      - Cache内容修改的同时修改内存中相应内容
      - 缺点：效率慢，消耗大
    - **写回Cache**：==只写Cache==，**仅当**==淘汰缓存块时==，==将修改的内容写回内存中==
      - 例：Cache一直在用一个页面，只在最后不用这个页面时写回到内存中
      - 优点：减少主存的写操作
    - **标记法**：==只写内存==，**每个**缓存块都有一个标记，来表示该缓存块中的数据来自主存中的哪个地址，每次修改将其==在内存中修改==，但是==修改时，要对Cache进行标记==，后面再用到对应标记的数据时，就从内存中直接调取新的数据
      - 注：Cache本质上就是==缓存==机制，实质的内容还是在==内存==当中
      - 注：标记通常和索引（Index）一起使用，用于快速定位缓存中的数据

## 磁盘(机械硬盘)

- 以==文件形式==存储数据

- CPU无法直接读取外存中的数据，需要将其==以文件为单位==调入内存中才能进行访问
- 外存包括：光盘、固态硬盘、磁表面存储器(机械硬盘、磁带)
- 磁盘结构
  - 由多个盘面组成，一个==盘片==可能有两个==盘面==，每个==盘面==上有一个==磁头==，==磁头==通过硬件==连接到主杆==上，==磁盘==始终进行==同向**固定速度**==旋转，而==磁头==沿着==半径方向**直线**运动==
  - 一个==盘面==可以划分成多个==同心圆==，每个圈就是一个==磁道==，而==磁道==又会被分成一个个==扇区==，最内侧扇区==面积==最小，因此数据==密度==最大
    - ==磁道==按==由外向内==进行编号，从0开始
  - 垂直来看，对应编号的磁道构成一个空心圆柱体，叫做==柱面==，而==磁头==就固定在某一个==柱面==上，==磁头==移动==寻找磁道==的过程就是在==寻找柱面==
  - 在==磁头找到==需要的==磁道==上后(叫做==寻道时间==)，==等待磁盘旋转==到所需==扇区==(叫做==等待时间==/==旋转延迟==)
    - 磁盘存取数据的时间(存取时间) = 寻道时间 + 等待时间
      - 寻道时间 远大于 等待时间，因为磁头的机械臂移动速度较慢，而磁盘转动速度很快
      - 所以在磁盘调度策略中，先移动磁头(==移臂调度==)，再进行==旋转调度==
    - 磁头移动到磁道，等旋转到对应扇区的==起始位置==就开始==读取数据==
      - 磁头读取数据依靠的是读取==介质中的正负磁性==，通过电流传输回去，因此传输时间很快可忽略不计
    - 注：==平均读取时间==是不包括==传输时间==的

- 固态硬盘与机械硬盘区别
  - 物理层面
    - 没有==扇区==和==盘面==，因此不是由机械存取，而是由芯片进行存储
    - 固态的存储芯片分为两种
      - 闪存
        - 非易失性存储器，即断电后数据仍能保存
        - 基于浮栅晶体管技术，可以多次擦写
      - DRAM
        - 易失性存储器，即断电后数据会丢失
        - 基于电容和晶体管，需要不断刷新以维持数据
    - 固态缺点
      - 写入次数有限制，次数是写入固定大小的数据才算一次

## 输入输出技术(I/O)

- 指的是==CPU控制==主存与==外设（I/O设备）==之间交互
- ==外设==速度慢，==内存==速度快，因此有以下几种平衡方式
  - 直接程序控制
    - 直接在==CPU==控制下，因此会==降低CPU效率==
    - 分为两种方式
      - 无条件传送
        - 外设总是准备好，可以随时接收CPU发来的输入/输出数据
      - 程序查询
        - 最傻的一种方式，可以理解为==轮询==，定期检查外设是否有数据可读，有就处理
        - 缺点：无法处理突发事件
  - ※程序中断方式(中断)
    - 可以理解为，外卖到了按铃通知
    - CPU正常执行任务，当外设需要处理数据时，会发送==中断信号==，==CPU==在收到以后，会暂停并==保存**正在执行**的程序现场==，然后处理I/O
    - 注：==不适用==于读写快速的==硬盘==，因为会==导致频繁中断==，只==适用于鼠标、键盘==这类
  - ※DMA
    - 相较于上两种方式都用CPU控制，占用CPU运行效率，DMA使用==主存和外设==进行数据交互，在==**传输过程**中无需CPU干预==
      - 注：在==过程开始时==，需要==CPU向外设发送传输指令==，在==过程结束后==，通过==中断==或==轮询==的方式==得知过程结束==，下一个操作是否准备就绪
      - 实际操作由DMA硬件完成，CPU发送完指令就走了、
    - DMA传输时单独开了一条==系统总线==（DMA可以直达主存的线路），这条线将DMA的==接口==与==主存==连接
      - 注：==DMA==和==CPU==都可以==直接访问主存==，但是==DMA的优先级更高！==DMA在传输时占用系统总线，此时CPU不能使用总线
        - 因为采用DMA的设备一般都是快速I/O外设，如显卡、声卡、网卡
  - 输入/输出处理机（IOP）
    - 又称==通道==，是个==处理器**硬件**==，分担一部分CPU功能，对外设的==统一管理==，完成外设与主存之间的数据传送
      - 激活通道需要激活程序，**但是**这个程序不是由CPU执行，而是由主程序上的==通道程序==执行==激活自身==
- 总结
  - 鼠标、键盘使用程序中断的方式
  - 显卡、声卡、网卡采用DMA