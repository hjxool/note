## 操作系统概述

- 何谓操作系统？
  - ==硬件==环境上==构建==得==软件==环境，这个软件可以使用硬件功能
    - 如手机操作系统、电脑操作系统、嵌入式操作系统
- 操作系统作用
  - 提高计算机使用效率
  - 提供人机界面
- 操作系统特性
  - 并发
    - 如：同时启动多个软件
  - 共享
    - 所有文件资源对程序都是共享的
  - 虚拟性
    - 类似 虚拟机，不是直接操作调动硬件，而是隔了一层
  - 不确定性
    - 如：并发引起的资源竞争，硬件故障等因素
- 操作系统功能
  - ※==进程==管理
  - ※==存储==管理
  - ※==文件==管理
  - ※==设备==管理
  - 作业管理
- 操作系统分类
  - 批处理 操作系统
  - 分时 操作系统
    - ==轮流==使用CPU
  - 实时 操作系统
    - 快速响应
  - 网络 操作系统
  - 分布式 操作系统
    - 物理意义上 ==分散== 的计算机 ==互联== 系统
  - 微机 操作系统
    - 如：Windows
  - 嵌入式 操作系统

- 计算机 启动 流程
  - `BIOS -> 主引导记录 -> 操作系统`
    - BIOS
      - 开机时会进入自检页面，只是厂家会用logo盖住，也可以用F12等进入BIOS
      - ==直接== 对 ==硬件== 进行设置
    - 主引导记录
      - 如：装了 双系统 时，选择进入哪个操作系统

## 进程的组成和状态

- 什么是 进程 ？
  - 程序 是一堆 `bit`序列，当运行时，CPU会在 内存 中为其开辟一块区域即 进程，因此 进程 就是 程序 的意思
  - 而 线程 是 进程 中 最小执行单元
  - ==进程==（程序）是计算机中 正在运行 的 ==程序的实例==
    - 是系统进行 资源分配 和 管理 的 ==基本单位==
    - 包括 **代码**、**数据**、执行**状态**
- 进程的 组成
  - 进程控制块（PCB）
    - 简单记，即 ==唯一标识==，进程管理界面中的 ID号
  - 程序
    - 描述进程 ==做什么==
  - 数据
    - 存储进程 ==执行时== 所需 ==数据==

- ==进程状态==分为
  - 非人为 干涉的三态图
    - 见书P50
    - 概念介绍
      - 运行
        - 进程正在执行，注意CPU中有 ==时间片段== 的概念，也就是 切换 执行程序，但是因为很快，所以宏观上看是 并行
        - 如果是 多核，每个核都可以设置一条 时间片段，轮换 执行任务
        - 注：运行 属于 三态图，所以具体程序执行多长时间让出CPU控制权，取决于计算机底层，分配给每个进程的 执行时间
      - 就绪
        - 运行 时间片段 到期后，进入==下一个状态== 即 ==就绪==状态
        - 等待下一次 受 CPU调度，拿到CPU使用权，再次进入 ==运行==状态
      - 等待（阻塞）
        - 当 进程 ==等待== 外部事件的结果时，会 挂起
        - 当 等待 的事件给出结果了，就会进入 ==就绪== 状态**排队**
        - 注：等待 **不能** 直接回到 运行状态
  - 人为 干涉的五态图
    - 多了 ==静止就绪== 和 ==静止阻塞== ，需要 人为 操作才会进入
    - 活跃就绪 即 就绪
    - 活跃阻塞 即 等待

## 前趋图和进程资源图

- ==前趋图==
  - 表示哪些 ==进程== 可以 ==并行== 执行，哪些 进程 之间有 ==顺序== 关系
- 进程 资源 图
  - 表示 ==进程== 和 ==资源== 之间的 ==请求== 和 ==分配== 关系
  - ==资源== 指向 进程的线，表示资源 ==分配== 给对应进程
  - ==进程== 指向 资源的线，表示进程 ==请求(申请)== 资源
  - ==阻塞== 节点
    - 进程 向 资源 请求，但是==资源已经分配完==，该 进程 就被阻塞，只能 等待 资源被释放 
    - 注：**无论** 进程 是否已经**被** 其他 资源池**分配了资源**，**只要**它所==请求的资源==池==没有空余==资源，就会==阻塞==！
    - 当图中所有 进程 ==都是阻塞节点== 时，即陷入 ==死锁== 状态
      - ==死锁== 状态==不可化简==
        - 化简 思路：让 非阻塞节点 先运行
          - 因此化简 ==顺序== 中 非阻塞节点 在前
    - 例：存在资源池R1和进程P1，R1将资源分配给P1，P1向R1请求，此时P1是 阻塞 节点
      - 因为R1分配后已经没有资源，而P1又请求资源，尽管此时P1已经被R1分配了资源，但是请求的是额外的资源，还是阻塞
  - ==非阻塞== 节点
    - **只要** 没有被阻塞，就是 非阻塞节点

## 同步与互斥

### 互斥

- 指 ==同一时间== **只允许一个**进程访问某个资源，其他进程必须==等待==
  - 互斥是为了防止多进程同时访问一个资源，造成数据损坏和程序崩溃
    - 如：打印机
    - 其实是一种 防卫场景
  - ==0== 表示有进程==占用==，==1== 表示 ==没有进程使用==
- ==临界资源==
  - 被==互斥方式==的进程访问的资源
- ==互斥信号量==
  - 访问 ==临界资源== 时的 控制==标识==，用0、1作为标识，使用 互斥信号量 后其他进程无法访问
    - 如：像厕所隔间的门锁，门锁打开时表示空闲，可以进入。门锁关闭时，其他人需要等待，要==获取== 门锁（==互斥信号量==）==才能使用==资源

### 同步

- 多进程互相协调，按 ==顺序== 执行
  - 同步 可以防止进程之间出现竞争和冲突，从而提高程序的正确性和效率
- ==同步信号量==
  - 是一个 ==共享==变量，表示资源的==数量==
    - 如：餐厅桌子有限，如果有餐桌空闲，可以直接使用，当餐桌都满了，顾客需要等待，餐桌就是 ==同步信号量== ，表示餐桌的==数量==

### PV操作

- P操作

  - ==申请==资源，`S = S - 1`
    - S：表示资源数
    - 申请了一个资源走，S就要减1
  - `S >= 0`时，S表示 ==资源数量==
    - 则 执行**P操作** 的进程 ==继续执行==

  - `S < 0`时，S表示 ==阻塞== 的进程数量
    - 则 进程变为 阻塞状态 ，并将其插入 ==阻塞队列==

- V操作

  - ==释放==资源，`S = S + 1`
  - `S > 0`时，表示 资源 有==空余==，没有 阻塞 的进程，该进程继续执行
  - `S <= 0`时，表示需要从 ==阻塞队列== 中 ==唤醒== 一个被P操作阻塞的进程，将其==插入就绪队列== ，然后==执行V操作==的进程继续
    - 注意！是`<= 0`时 唤醒 ，说明释放一个资源就 立马 分给排队的进程

### 生产者和消费者 类型问题

- 三个信号量
  - 互斥 信号量S~0~
    - 即仓库 独立 使用权
  - 同步 信号量S~1~
    - 即仓库 空闲位置
  - 同步 信号量S~2~
    - 即仓库 现有 商品个数
- ==生产者== 流程
  1. ==生产== 商品：占用 互斥 信号量S~0~
  2. P(S~0~)：==占用== 仓库 ==使用权==，S~0~ - 1 = 0
     - S~0~ 是 互斥信号量 ，空闲 时，值为1
  3. P(S~1~)：==申请== 仓库 ==空位== ，设S~1~初始值为100个，S~1~ - 1 = 99
  4. 将商品 ==放入== 仓库中
  5. V(S~2~)：仓库 商品个数+1，S~2~初始值为0个，S~2~ + 1 = 1
  6. V(S~0~)：已完成操作，==释放== 互斥信号量
- ==消费者== 流程
  1. P(S~0~)：==占用== 仓库 ==使用权==，S~0~ - 1 = 0
  2. P(S~2~)：==消耗== 仓库商品，S~2~ - 1 = 0
  3. 取出一个商品
  4. V(S~1~)：==释放== 一个仓库 ==空位==，S~1~ + 1 = 100
  5. V(S~0~)：==释放== 仓库 ==使用权==

## 死锁和线程

- 题目

  - 前趋图 图1

    ![image-20250219113938021](C:/Users/admin/AppData/Roaming/Typora/typora-user-images/image-20250219113938021.png)