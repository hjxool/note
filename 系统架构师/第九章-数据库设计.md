## 概述

- 数据：是==数据库中==存储的==基本对象==，是==描述事物==的符号记录
- 数据的分类：文本、图像、音视频
- 数据库（DB）：是长期存储在计算机内、有组织的、可共享的大量数据的集合
- 数据库的特点
  - 可为各种用户共享数据
  - 冗余度较小
  - 数据独立性较高
  - 易拓展
- ==数据库系统==（DBS）：能够==操作==和==管理==存储在==硬件==上的==数据==的==软件==，由以下几个部分==组成==
  - 数据库：以==文件==的形式==存储==在磁盘上
  - 硬件：==外置存储设备==，如磁盘
  - 软件：操作系统、==数据库管理系统（DBMS）==和应用程序
  - 人员：就是用户，以及==数据库管理员（DBA）==
- ==数据库**管理**系统==（DBMS）的==功能==
  - 对共享数据的有效组织、管理、存取
  - 数据库建立、运行、操作、维护，数据的存储管理

## 三级模式 两级映像

### 三级模式

- 指数据库管理系统从以下几个层次管理数据
  - ==外模式==
    - 就是跟用户交互的视图层，如页面或软件上显示个人数据
    - 只显示适合用户查看的数据，如数据库表中性别用0或1表示，在视图上则是男或女
    - 不是展示表中所有字段，而是取需要的部分展示，只允许用户看到部分数据，或不同用户看到不同数据
    - 注：表的数据是存储在磁盘上的，而**视图**看到的数据是**查询出来**的
  - ==概念模式==
    - 又称为==模式==、==逻辑模式==，在试题中看到要知道是概念模式
    - 开发人员设计表的蓝图，不是数据库里的具体的表，是抽象、语义化的描述表中应该有的字段和功用，如`students`表，里面有学生的学号、姓名、性别等
    - 跟Excel表格一样，只不过除了要设计列，还要限制每列的数据类型、长度等
  - ==内模式==
    - 又称为==物理模式==、==存储模式==
    - 就是存储在硬盘中的文件，类似Excel文件，在概念层，开发人员使用表的形式操作表文件

### 两级映像

- 因为三级==模式==都是==相互独立==，所以映像就是为了联系各层模式，体现了各层独立性和隔离性
  - ==逻辑独立==性
    - 外模式和概念模式之间的映像体现了==逻辑独立==性。即==逻辑表的修改不会影响外层视图==
    - 如：原本一张表中有“库存”、“销量”这两个字段，外模式（视图）展示的“库存”和“销量”这两个字段，并**不会随**“库存”或“销量”这两字段被**分开存到不同表**中而**显示异常**
  - ==物理独立==性
    - 概念模式和内模式之间的映像体现了==物理独立==性。即==修改了内模式不影响概念模式和外模式==
    - 如：把内模式文件的`.xls`改为`.xlxs`，或者把数据库从MySQL改为Oracle，对外模式视图和概念模式是没有影响的

## 数据库设计

- 分为以下几个步骤进行
  1. ==需求分析==（考点）
     - 产出==数据流图==、==数据字典==、==需求说明书==
     - 如：顾客是做烧烤的，想要一套财务管理系统，沟通时要确定他会**用到哪些**数据、要用这些数据**做什么**，想**得到哪些**数据，最后得出==需求说明书==
  2. ==**概念**结构设计==（考点）
     - 产出==E-R图==，即实体-联系图，也叫==概念模型==
     - 注：2~4步骤数据概念层面的设计
     - 概念设计阶段有以下几个步骤
       1. 分解出有哪些模块
       2. 设计模块的E-R图
       3. 合并模块E-R图为总E-R图
          - 合并时可能会遇到==属性冲突==（考点），即同一属性可能存在于多个模块，如学生表，有学生姓名，还有个班级表，里面有学生姓名，课程表，里面有学生姓名
          - 合并时还可能遇到==命名冲突==（考点），即**相同意义**的属性，在不同模块的E-R图中有**不同**的**命名**，或**命名相同**的属性，在不同E-R图中有**不同含义**，如学生表中，学生ID叫学号，在班级中又叫学生名
          - 合并时可能会遇到==结构冲突==（考点），即同一实体对象在一个模块中属性有5个，在另一模块中有8个属性，没有统一标准。如学生表在模块A中有3列属性，在模块B中有8列属性
  3. ==**逻辑**结构设计==
     - 产出==关系模型==，即==表结构蓝图==
  4. 物理设计
     - 确定数据分布、存储结构、访问方式，即==选用哪种数据库==、数据库需要不需要专门的备份、访问方式、存储层级结构等
  5. 数据库实际开发
     - ==实际开发数据库中表==
  6. 数据库运维
     - ==改BUG==、==调整表结构==等

## 数据模型

### 概念模型（考点）

- 就是E-R图

- E-R图

  ![E-R图.png](https://github.com/hjxool/static-resource-save/blob/main/E-R%E5%9B%BE.png?raw=true)

  - 强实体：对应一张表，如员工表示有一张表

  - 弱实体：强实体中的具体分类，如经理不是一张单独的经理表，而是员工表中员工，只不过经理在员工表中的`Job`属性值为经理

    - 注：简单来记忆就是面向对象中的继承，弱实体依赖于强实体而存在

  - 菱形：动词，表示关联关系，如经理和超市，经理 管理 超市

  - 数字或`*`号：表示1对1、1对多等对应关系，如员工和部门，员工 所属 部门，且员工和部门属于1对多的关系

    - 注：`*`号、`m`、`n`都表示多个

  - 椭圆（一般题目中没有）：表示属性，用于描述实体中有哪些属性

    ![E-R图2.png](https://github.com/hjxool/static-resource-save/blob/main/E-R%E5%9B%BE2.png?raw=true)

  - 实体集：就是表，比如学生表，里面每个学生就是实体

### 关系模型（考点）

- 就是表结构，跟Excel表一样

  ![关系模型图.png](https://github.com/hjxool/static-resource-save/blob/main/%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B%E5%9B%BE.png?raw=true)

- 优点

  - 结构简单、清晰易懂
  - 存取路径对用户透明，从而数据独立，简化数据库开发，即没有`a.b.c`，直接取姓名等属性即可

- 缺点

  - 由于存取路径透明，查询效率往往不如非关系数据模型
    - 如用户表和朋友表，要获得一个用户的朋友关系，需要进行表连接，通过一个表查另一个表中数据，而非关系数据模型（如MongoDB），可以直接存储用户和他们的好友

### 网状模型

- 就是把E-R图中的E（实体）取出，以一对一、一对多、多对多的形式连线

### 面向对象模型

- 采用面向对象方式设计数据库，以对象为单位，对象包括属性和方法，具有类和继承
- 注：一般都是用结构化法，从顶向下设计，不会用到面向对象模型

### 数据模型 三要素

- 数据==结构==
  - 即有哪些属性、属性值类型、属性值长度
- 数据==操作==
  - 即**增删改查**
- 数据的==约束==条件
  - 即**范式**和**约束**
    - ==范式==
      - 第一范式（==1NF==）：要求每一列都是原子值，**不能有重复**的列
      - 第二范式（==2NF==）：要求**非主键**列完全**依赖**于**主键**，如学生表中，学号是主键，学生的其他属性取决于学号多少
      - 第三范式（==3NF==）：要求非主键列不能依赖于其他非主键列，如学号是主键，学生的姓名不能由学生的成绩值决定，只取决于学号

### E-R图如何转换为实体表

- 使用以下方式进行转换
  - 实体对应一个关系模型（表）
  - 实体名对应表名
  - 属性对应表的列
  - 联系对应表的码
    - 如：有`Person`、`Card`两张表
      - 如果是`1:1`（==1对1==）联系，则==互存主键==，可将`Person`中的`pid`放到`Card`中，将`Card`中的`cid`放到`Person`中，这样两张表都能找到对方；或建一张单独的表，用来存`pid`和`cid`之间的映射关系
      - 如果是`1:N`（==1对多==）联系，则在==N端加入1端==表的==主键==
      - 如果是`M:N`（==多对多==）联系，**必须**==单独建表==，建一张表`Person_Card`，里面`id`为主键，`pid`、`cid`为==外键==（见上述约束内容）==对应==`Person`、`Card`中==主键==

## 关系代数

- 简单来说就是数据库查询条件

- ==交==（==∩==）

  - 两张表取交集，结果==只保留==两张表中==相同==的记录

- ==并==（==∪==）

  - 两张表取并集，不同的部分堆叠，相同的部分只保留一个

- ==差==（==—==）

  - 求差要注意顺序！表1减表2，和表2减表1是不同的结果！
  - **表1**减**表2**：结果保留**表1有**，而**表2没有**的部分
  - **表2**减**表1**：结果保留**表2有**，而**表1没有**的部分

- ==笛卡尔积==（==X==）

  - 两张表相乘

  - 两张表中==所有列==一并==展示==，哪怕是相同列名

  - 数据相乘。表1==每一列中每一项==与表2中==对应列的每一项==数据取==交集==，如两张表各有3条记录，则结果为3 x 3 = 9 行记录

    - 注：数据相乘在数据库查询语句中，有单独的操作符`crossjoin`

  - 应用场景：如计算某球队在主客场中和各个队比赛结果

    ![笛卡尔积.png](https://github.com/hjxool/static-resource-save/blob/main/%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF.png?raw=true)

- ==投影==（==Π：读作pai==）

  - 用来==筛选列==，相当于SQL语句中`select 列名1, 列名2, ...`
  - 如上图表S1求1、2列投影，写作Π~1,2~S1，其中`1,2`表示第几列

- ==选择==（==6：读作seigema==）

  - ==筛选行==，相当于SQL语句中的`where 条件`语句
  - 如上图表S1求`Sno`值等于`No0003`的记录，写作6~1=No0003~S1，其中`1 = No0003`，1表示第几列，中间是条件符号，`No0003`表示条件值

- ==自然连接==（==⋈==）

  - ==列名取**并集**==，==重复==的列==只保留一个==

  - ==数据取**交集**==

    ![自然连接.png](https://github.com/hjxool/static-resource-save/blob/main/%E8%87%AA%E7%84%B6%E8%BF%9E%E6%8E%A5.png?raw=true)

    - 如图，表R和表S自然连接，先对列取并集，得ABCD四列，再将表R与表S中列A、C同一行都相同的记录连接在一起，得图中结果

## 函数依赖

- 给定一个X，能唯一确定一个Y，就称X决定（`->`）Y，或者说Y依赖X
  - 如，Y = X^2^，`X = 2`时`Y = 4`，X能确定Y的值，而`Y = 4`时`X = 2`或`X = -2`，Y无法确定X的值，所以称`X -> Y`
- 函数依赖又可拓展两种规则
  - ==部分函数依赖==
    - 如`A -> C`（A决定C）、`AB -> C`（A和B形成的组也可以决定C），既然A都可以决定C了，有没有B就无所谓了，这就是==部分==函数依赖
  - ==传递函数依赖==
    - 如`A -> B`、`B -> C`则`A -> C`，这就是==传递==函数依赖，**但是**！如果A等于B，就不是传递

### 函数依赖公理系统

- 就是推导公式（理论），也称阿姆斯特朗公理，了解即可
- 有以下推理规则
  - 自反律：如果属性集合 Y 属于 X，则`X -> Y`
  - 增广律：就是 自反律 的乘法，如果属性集合`X -> Y`，那么`XZ -> YZ`
  - 传递律：同 传递函数依赖，如果`X -> Y`且`Y -> Z`，那么`X -> Z`
- 由上面3条规则推理出以下几条规则
  - 合并律：如果`X -> Y`且`X -> Z`，那么`X -> YZ`
  - 分解律：如果`X -> YZ`，那么`X -> Y`且`X -> Z`
  - 合成律：如果`X -> Y`且`Y -> Z`，那么`XZ -> YZ`

## 键

- ==超键（码）==
  - 能够唯一标识一条记录的==属性==或==属性集==，即==**只要**能标识一条记录的属性组合或属性就是超键==
    - 注：可以说==主键==是从==超键==中抽取出的一小部分
  - 如学生表，包含属性：学号、姓名、性别、出生日期，超键可以是：{学号}、{学号，出生日期}、{姓名，性别，出生日期}，因为这些属性组合都可以唯一标识每个学生
- ==候选键==
  - 是==超键==的一个==子集==，去除了超键中的非关键属性，也就是说候选键中每个属性都是必须的，即==能唯一标识一条记录的就是最小属性集（属性）==
  - 如学生表，{学号}是候选键，因为它是唯一标识学生的最小属性集
    - 如果**姓名**也**不能重复**，则{姓名}也是候选键，但是{姓名，性别，出生日期}不是候选键，因为姓名已经可以是唯一标识，就不需要性别和出生日期
- ==主属性==
  - 候选键可能有多个，主属性就是==候选键的**并集**==
    - 注：还有个非主属性，即与主属性相反的概念
  - 如上例中，如果姓名不能重复，则候选键为{学号}、{姓名}，主属性则为学号和姓名
- ==主键==
  - 从候选键中选一个，作为唯一标识
- ==外键==
  - 就是用于建立表之间的关联
  - 如有一部门表`id:101, name:开发部`，又有一员工表`id:201, name:'张三', depID:101`，其中`depID`就是==外键==，用于关联部门表中的主键
- 总结
  - ==超键==包含==候选键==，==候选键==包含==主键==
  - ==主属性==则是==候选键==的并集

## 约束

- ==主键==约束（实体完整性约束）
  - 要求每一**行**数据都有一个**唯一标识**，如学号
- ==外键==约束（参照完整性约束）
  - 即用于**表之间关联**的**唯一标识**，如在课程表中，学号用于定位到学生表中具体学生，学生表中也有课程号定位到课程表中具体哪个课程
- ==唯一==约束
  - 要求某一列或某几列的值在表中是唯一的
  - 注：与**主键约束**的区别在于**唯一约束**可以有多个“主键”，即多个列的值都可以是唯一值
- ==非空==约束
  - 要求某一列的**值不能为空**，如订单表中，订单日期可以设置为非空约束，确保每个订单都有一个日期

## 范式

