## 嵌入式微处理器体系结构

### 冯·诺依曼体系结构

- 也称==普林斯顿结构==

- （考点）特点

  1. 程序（指令）和数据==共用==一个==存储空间==。指令和数据放在同一存储器的==不同地址==上

  2. ==单一==的地址和数据==总线==，地址总线和数据总线传输数据的二进制位数相同
     - 注：**地址**总线是**单向**，**数据**总线是**双向**，只有一条总线，传输地址时是单向，传输数据时是双向，在不同时间段进行

  3. ==串行执行==

     - 流程：CPU==执行指令==时，先从存储器(如内存)中取指令地址(==取址==)，再通过==总线==传回CPU，CPU将其递给 ==寄存器== ，对指令进行解码，取操作数(==取数==)的地址，再走 地址==总线== 找到存储的==数据==，取出数据通过==总线==返回给CPU

     - ==串行==的理解
       1. 必须**先**取址，**才能**取数据
       2. 总线不能并行，总线**不能同时执行**传数据和传地址

### 哈佛体系结构

- （考点）特点
  1. 程序（指令）和数据存在==**不同**存储空间==，==各存储器**独立**编址、**独立**访问==
     - 程序存储器和数据存储器物理上相互独立
     - 独立编址：如两栋楼，都有12层
  2. ==独立==的**地址**和**数据**==总线==，两个存储器对应两套独立的地址总线和数据总线
  3. ==并行==执行，提高速度
     - 并行不是指取址、取数乱执行，执行还是按先后顺序执行，但是因为分成了不同的设备，有不同的线路，所以在第一条取址的设备操作完，轮到另一设备进行取数时，取址的设备就可以第二条指令的取址操作了

### 两者区别

- 冯·诺依曼 是==单车道==，哈佛 是==多车道==
- 冯·诺依曼 的好处是==简单、易于实现和设计==，哈佛 的好处 因为是多车道，==可以用不同技术优化性能==
- 冯·诺依曼 ==适用大多数计算机==，哈佛 ==适用于特定应用领域==(如DSP)

## 微处理器分类

### 按 同时处理量 分类

- 根据处理器能够==同时处理==数据的字长(字长宽度)，可分为4位、8位、16位、32位、64位

  - 16位及以==下==的称为==嵌入式微**控制器**==

  - 32位及以==上==的称为==嵌入式微**处理器**==

### 按 集成度 分类

- 按系统==集成度==划分，可分为两类

  - 微处理器内部**仅包含**==中央处理器==单元（如==CPU==），称为==一般用途型微**处理器**==

  - 将CPU、ROM、RAM、I/O等硬件==集成==到==同一芯片==（==单片机==），称为==单芯片微**控制器**==

### 按 用途 分类

#### 微控制器 MCU

- 嵌入式==微控制器**MCU**==（==CPU + 内存 + 外设==）
  - 注：因为是==控制器==，所以处理能力只有16位及以下，结合==集成度==分类，可知 MCU 是==单芯片==微控制器
  - 典型代表是==单片机==，将CPU等硬件集成在一片芯片上，形成==芯片级计算机==
  - 因为集成在芯片上，即==单片化==，所以体积大大减小，功耗和成本也降低，但体积小意味着能做的事情不能太复杂，像家用电脑一样，所以只适用于==控制==外设资源，主流是用作==嵌入式系统工业==
    - 如：遥控器、电控门等

#### 微处理器 MPU

- 嵌入式==微处理器**MPU**==（==CPU==）
  - 注：是==处理器==，所以32位以上
  - 与**计算机处理器**不同的是，==只保留和嵌入式应用紧密相关的功能硬件==，去除其他冗余功能部分，就能以==最低功耗和资源==实现嵌入式应用的特殊需求
    - 即定制CPU
  - 优点：==体积小、重量轻、成本低、可靠性高==
  - ==应用==场景：==高性能计算==和==复杂算法==处理的系统，**不过需**外挂==大容量存储器==（如DDR 和 FLASH）来支持允许复杂操作系统和大型程序
    - **复杂**算法：注意与==大量计算==区分，如1亿个`1+1`的计算，这叫**大量**计算，而 MPU 的复杂计算应对的是更==复杂的业务==计算
  - **MPU** 与 **MCU** 比较
    - 嵌入式系统**更多使用**的是微控制器（**MCU**），因为大多嵌入式系统不需要太复杂的计算，只需要根据只能做出反应即可，如无人机、遥控器。因此使用 **MCU** ==更节省成本和功耗==，并可以==简化硬件设计==
      - 举个例子，某项目需要在桥梁下安装智能终端收集桥梁震动数据，来记录有多少车辆通过，使用MCU可以坚持一年才更换电池，而MPU可能过两天就没电了
      - 所以嵌入式更多考虑的是==低功耗==这点

#### 数字信号处理器 DSP

- 嵌入式微==数字信号处理器**DSP**==
  - 专门用于==信号处理==方面的处理器，在**系统结构**和**指令算法**方面进行了特殊设计，具有很==高==的==编译效率==和指令==执行速度==
  - 采用==哈佛==结构，流水线处理，处理速度比最快的CPU还快10~50倍，强大的==数据处理能力==，和==高运行速度==是两大特色
    - 对比 **MPU** 的复杂算法处理，**DSP** 更擅长==大量==的简单计算
  - 应用
    - ==通信==领域：用于调制解调、信道编解码等
      - 如：==GSM==、==CDMA==、==LTE==等打电话用到的通信场景都用DSP
    - ==音频==领域：音频编解码、声音增强、**降噪**、回声抑制、**语音识别**等
      - 如：手机、耳机
    - ==图像==处理领域：图像压缩、图像增强、边缘检测等
      - 如：数字相机、手机摄像头、监控、医疗图像等
    - ==雷达==和==信号==处理领域：雷达信号处理、目标跟踪、信号分析等
      - 如：航空、汽车、等
    - ==控制==领域：机器人、航天飞行器等
      - 如：自适应控制、PID控制等
    - 生物==医学==领域：心电信号处理、医学影像、脑电信号等
      - 如：心电图、**CT**等

#### 片上系统 SoC

- 嵌入式==片上系统**SoC**==
  - 题外话：华为的芯片大战，聚焦点就是SoC
  - **类似** ==MCU(单片机)== 将各种硬件集成到芯片上，分为==控制部件==（**微处理器**、存储器）和==执行部件==（**I/O**接口、微型开关、微机械），但与 MCU 的**区别是**==软硬件结合==，直接将==操作系统代码==存储在Flash==存储器==中。是一个有**专用目标**的集成电路，包含操作系统和对应==功能软件==
    - 如高端SoC芯片用于**手机**、**平板电脑**等
    - 次高端SoC芯片用于安防、**物联网**等领域
    - 专用型SoC芯片用于**智能手表**等
  - SoC采用了==片内可再编程技术==，使SoC内硬件功能可以像软件一样通过编程来配置，从而灵活的修改和开发
    - 片内可再编程技术：即所谓的==刷机==，类似于重新安装电脑系统。而新刷入的系统如何支持原有硬件，依赖于==驱动程序==。==驱动程序是操作系统与硬件之间的桥梁==，它们负责控制和管理硬件设备。==每个硬件设备都有对应的驱动程序==，操作系统通过这些驱动程序与硬件进行通信。所以刷机的新系统只要==携带对应驱动程序==就仍可以控制原有硬件功能

## 多核处理器

### 基本概念

- 单 CPU 从微观上来看是串行执行任务，宏观上是并行，而原先想要让任务在微观层面也能够并行执行，就得安插多个 CPU ，这也意味着需要多个供电插槽，而随着芯片技术发展，现在已经可以一个芯片内装多个==微处理器==，即所谓的==多核==处理器
- ==多核==指==多个微处理器==内核，是将==多个微处理器==集成在==单枚芯片==中，这样只需要单个处理器插槽
- ==多核==与==多CPU==对比，很好的==降低==了计算机==功耗==和==体积==
- 多核技术中，操作系统可进行==调度==、==多进程==、==多线程并发==

### 运行模式

- 为了更合理的分配微处理器资源，就有了三种运行模式，具体使用哪种，取决于==应用场景==和==硬件差异==

#### 非对称 多处理 AMP

- 两个处理内核职责并不相同，各自处理==特定的功能==，在==软件协调==下分担不同计算任务
  - 类似CPU和GPU，后者关注图像和人工智能的计算

#### 对称 多处理 SMP

- 两颗==完全一样==的处理器，达到双倍或接近双倍的处理性能，节省运算资源

#### 混合 多处理 BMP

- 两颗==完全一样==的处理器，**但**可以==指定==**任务**仅在指定**内核**上执行

### 调度情况

- 当有多个任务运行，如何进行CPU分配

#### 全局队列调度

- 操作系统维护一个==全局的任务等待队列==，这个队列里全是等待执行的任务，当有CPU空闲时，操作系统就从全局队列中选取就绪任务开始执行
  - 简单记：看哪个闲，让哪个工作
- 优点：==CPU核心利用率高==

#### 局部队列

- 为==每个CPU==维护一个==局部==的任务等待==队列==，只有对应CPU的局部队列有任务，才会让对应CPU去工作
- 优点：无需在多个CPU之间切换

## 嵌入式系统

- 与嵌入式操作系统的区别
  - 嵌入式系统是从整体描述
  - 嵌入式操作系统则是其中的软件组成部分

### 组成

- ==硬件==部分
  - 嵌入式==处理器==
    - 除了前述==低功耗、体积小==等需求，根据不同环境，==工艺==上可分为==民用==、==工业==、==军用==三个档次
  - 相关==支撑**硬件**==
    - 指==除了==嵌入式==处理器以外==的==其他硬件==，包括存储器、定时器、总线、I/O接口及专用硬件
- ==软件==部分
  - ==嵌入式操作系统==
    - （考点）与==通用操作系统==的**不同**：嵌入式操作系统应具备==实时==性、==可裁剪==性、==安全==性等特征
      - 可裁剪性：即系统==定制化开发==
  - ==支撑**软件**==
    - 指为**应用软件**开发运行提供==公共服务==、软件==开发==、==调试==能力的==软件==，支撑软件的公共服务通常运行在操作系统之上，以==库==的方式被应用软件调用