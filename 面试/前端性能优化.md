## CDN

### 概念

- CDN：全名内容分发网络，指通过互联网互相连接的电脑网络系统，利用最靠近每位用户的服务器，更快、更可靠地将音乐、图片、视频、应用程序及其他文件发送给用户

### 作用

- 用于托管Web资源(图片、js文件等)，可供下载的资源(媒体文件、软件等)，使用CDN可以加速这类资源的访问
  - 性能方面
    - 内容来自最近的数据中心，延迟更低
    - 资源请求分配给CDN，减轻服务器负载压力
  - 安全方面
    - CDN会防御网络攻击，限制请求频率，并且对整个通信链路用HTTPS加密

### 原理

- CDN与DNS有着联系
  - 输入`www.xxx.com`域名后DNS解析过程
    1. 检查浏览器缓存
    2. 检查操作系统缓存，如`hosts`文件
    3. 检查路由器缓存
    4. 前几步没找到，则会向ISP(网络服务提供商)的LDNS服务器查询
    5. 如果LDNS没找到，则会向根域名服务器请求
    6. 最终得到域名对应的IP地址
- CDN工作原理
  1. 当DNS发现URL对应的是CDN专用的DNS服务器，会将域名解析权交给CDN专用的DNS服务器，CDN专用DNS服务器将CND的全局负载均衡设备IP地址返回给用户
  2. 客户端向CDN的全局负载均衡设备发起数据请求
  3. CDN的全局负载均衡设备根据用户的IP地址、URL，选择一台用户所属区域的区域负载均衡设备，告诉用户向这台设备发起请求
  4. 区域负载均衡设备选择一台合适的缓存服务器来提供服务，将该缓存服务器的IP地址返回给全局负载均衡设备
  5. 全局负载均衡设备把服务器的IP地址返回给用户
  6. 用户向该缓存服务器发起请求，缓存服务器响应用户的请求，将用户所需内容发送至用户终端

### 使用场景

- 第三方的CDN服务
  - 当想要开源一些项目，可以使用第三方的CDN服务
- 静态资源的缓存
  - 将网站的静态资源放在CDN上，比如js、css、图片等。可以将整个项目放在CDN上，完成一键部署

- 直播传输
  - 直播本质上是使用流媒体进行传输，CDN也支持流媒体，所以直播完全可以使用CDN来提高访问速度
  - CDN在处理流媒体的时候与处理普通静态文件有所不同。普通文件如果在边缘节点没有找到的话，就会去上一层接着寻找，但是流媒体本身数据量就非常大，如果使用回源的方式，必然会带来性能问题，所以流媒体一般采用的都是主动推送的方式来进行

## 懒加载

### 概念

- 在长网页中延迟加载==图片==数据，是一种较好的网页性能优化的方式，只加载用户视窗口能看到的那一部分图片数据

### 使用场景

- 图片较多、长列表场景

### 原理

- 图片加载是由`src`引起，当对`src`赋值时，浏览器就会请求图片资源，根据这个原理，使用HTML5 的`data-xxx`==自定义标签属性来储存图片的路径==，在需要加载图片的时候，将`data-xxx`中图片的路径赋值给`src`，这样就实现了图片的按需加载
- 重点在于确定用户需要加载哪张图片，通过以下几个属性判断
  - `innerHeight` 可视区域的高度
  - `scrollTop` 滚动过的距离
  - `imgs.offsetTop` 是元素顶部距离文档顶部的高度（包括滚动条的距离）
  - 图片加载条件：`img.offsetTop < dom.innerHeight + dom.scrollTop`